        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>OperationRequest class / nuxeo_automation_client Library / Dart Automation Client Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="nuxeo_automation_client" data-type="OperationRequest">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Automation Client Documentation</a>
         &rsaquo; <a href="../nuxeo_automation_client.html">nuxeo_automation_client</a> &rsaquo; <a href="../nuxeo_automation_client/OperationRequest.html">OperationRequest</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>OperationRequest</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p><a class="crossref" href="../nuxeo_automation_client/OperationRequest.html">OperationRequest</a> wraps an <code>Operation</code> call.
This class implements the <a class="crossref" href="../nuxeo_automation_client/OperationRequest.html#call">call</a> method so it can be invoked as a <a class="crossref" href="../dart_core/Function.html">Function</a>.
Tipically this is called through the <code>OperationRegistry</code>.</p>
<pre class="source">
class OperationRequest extends nx.Request {

 static final Logger LOG = new Logger("nuxeo.client.request");

 String id;
 Uri _opUri;
 Duration execTimeout, uploadTimeout;

 nx.AutomationUploader _batchUploader;

 OperationRequest(this.id, Uri uri, nx.Client client, {
     this.execTimeout, this.uploadTimeout}) : super(uri, client) {
   _opUri = Uri.parse("$uri/$id");
 }

 Future&lt;nx.Operation&gt; get op =&gt; nx.OperationRegistry.get(uri, httpClient).then((registry) =&gt; registry[id]);

 /// Call the operation.
 /// Returns a [Future]
 /// Throws [ClientException]
 Future call({
         dynamic input: null,
         Map&lt;String, Object&gt; params: null,
         Map&lt;String, String&gt; context: null,
         String repository,
         String documentSchemas: "dublincore",
         bool voidOp: false}) =&gt; op.then((nx.Operation op) {

     if (op == null) {
       throw new ArgumentError("No such operation: $id");
     }

     var data = {};

     // Setup the parameters
     if (params != null) {
       data["params"] = {};
       params.forEach((key, value) {
         var param = op[key];
         if (param == null) {
           throw new ArgumentError("No such parameter '$key' for operation ${op.id}.");
         }
         if (value != null) {
           data["params"][key] = value;
         }
       });
     }

     var targetUri = _opUri;

     // Check for batch upload
     if (_hasBatchUpload) {
       if (data["params"] == null) {
         data["params"] = {};
       }
       data["params"]["operationId"] = id;
       data["params"]["batchId"] = batchId;

       // Override the target url
       targetUri = Uri.parse("${uri}/batch/execute");
     }

     var isMultipart = (input is http.Blob);

     // Setup the input
     if (input != null &amp;&amp; !isMultipart) {
       data["input"] = input;
     }

     // Setup the context
     if (context != null) {
       data["context"] = context;
     }

     var request = httpClient.post(targetUri, multipart: isMultipart);

     // Setup the headers
     setRequestHeaders(request, repository: repository, documentSchemas: documentSchemas);

     request.headers.set(nx.HEADER_NX_VOIDOP, voidOp.toString());

     var json = JSON.encode(data);
     LOG.finest("Request: $json");

     // The data to send
     var requestData;

     // check for multipart request
     if (isMultipart) {
       var params = new http.Blob(content: json, mimetype: nx.CTYPE_REQUEST_NOCHARSET, filename: "request");
       var formData = new http.MultipartFormData();
       formData.append("request", params);
       formData.append(input.filename, input);
       requestData = formData;
     } else {
       // Set the content type
       request.headers.set(http.HEADER_CONTENT_TYPE, nx.CTYPE_REQUEST_NOCHARSET);
       requestData = json;
     }

     return request
         .send(requestData)
         .catchError((e) {
           throw new nx.ClientException(e.message);
         })
         .then(handleResponse);


 });

 String get batchId =&gt; _batchUploader.batchId;
 bool get _hasBatchUpload =&gt; _batchUploader != null;

 nx.AutomationUploader get uploader {
   if (_batchUploader == null) {
     _batchUploader = new nx.AutomationUploader(uri, httpClient);
   }
   return _batchUploader;
 }
}
</pre>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../nuxeo_client/Request.html">Request</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>OperationRequest</strong></span></p>
<div>
<h3>Static Properties</h3>
<div class="field"><h4 id="LOG">
<button class="show-code">Code</button>
final Logger         <strong>LOG</strong> <a class="anchor-link"
            href="#LOG"
            title="Permalink to OperationRequest.LOG">#</a>
        </h4>
        <div class="doc">
<pre class="source">
static final Logger LOG = new Logger("nuxeo.client.request")
</pre>
</div>
</div>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>OperationRequest</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> id, <a href="http://api.dartlang.org/dart_core/Uri.html">Uri</a> uri, <a href="../nuxeo_client/Client.html">Client</a> client, {<a href="http://api.dartlang.org/dart_core/Duration.html">Duration</a> execTimeout, <a href="http://api.dartlang.org/dart_core/Duration.html">Duration</a> uploadTimeout}) <a class="anchor-link" href="#"
              title="Permalink to OperationRequest.OperationRequest">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="../dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="../dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="../dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div></div>
<pre class="source">
OperationRequest(this.id, Uri uri, nx.Client client, {
   this.execTimeout, this.uploadTimeout}) : super(uri, client) {
 _opUri = Uri.parse("$uri/$id");
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="batchId">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>batchId</strong> <a class="anchor-link"
            href="#batchId"
            title="Permalink to OperationRequest.batchId">#</a>
        </h4>
        <div class="doc">
<pre class="source">
String get batchId =&gt; _batchUploader.batchId;
</pre>
</div>
</div>
<div class="field"><h4 id="execTimeout">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Duration.html">Duration</a>         <strong>execTimeout</strong> <a class="anchor-link"
            href="#execTimeout"
            title="Permalink to OperationRequest.execTimeout">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Duration execTimeout
</pre>
</div>
</div>
<div class="field inherited"><h4 id="httpClient">
<button class="show-code">Code</button>
final <a href="../http_client/Client.html">Client</a>         <strong>httpClient</strong> <a class="anchor-link"
            href="#httpClient"
            title="Permalink to OperationRequest.httpClient">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
http.Client get httpClient =&gt; nxClient.httpClient;
</pre>
</div>
</div>
<div class="field"><h4 id="id">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>id</strong> <a class="anchor-link"
            href="#id"
            title="Permalink to OperationRequest.id">#</a>
        </h4>
        <div class="doc">
<pre class="source">
String id
</pre>
</div>
</div>
<div class="field inherited"><h4 id="nxClient">
<button class="show-code">Code</button>
<a href="../nuxeo_client/Client.html">Client</a>         <strong>nxClient</strong> <a class="anchor-link"
            href="#nxClient"
            title="Permalink to OperationRequest.nxClient">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
Client nxClient
</pre>
</div>
</div>
<div class="field"><h4 id="op">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_async/Future.html">Future</a>&lt;<a href="../nuxeo_client/Operation.html">Operation</a>&gt;         <strong>op</strong> <a class="anchor-link"
            href="#op"
            title="Permalink to OperationRequest.op">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Future&lt;nx.Operation&gt; get op =&gt; nx.OperationRegistry.get(uri, httpClient).then((registry) =&gt; registry[id]);
</pre>
</div>
</div>
<div class="field inherited"><h4 id="repo">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>repo</strong> <a class="anchor-link"
            href="#repo"
            title="Permalink to OperationRequest.repo">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
String repo
</pre>
</div>
</div>
<div class="field"><h4 id="uploader">
<button class="show-code">Code</button>
final <a href="../nuxeo_client/AutomationUploader.html">AutomationUploader</a>         <strong>uploader</strong> <a class="anchor-link"
            href="#uploader"
            title="Permalink to OperationRequest.uploader">#</a>
        </h4>
        <div class="doc">
<pre class="source">
nx.AutomationUploader get uploader {
 if (_batchUploader == null) {
   _batchUploader = new nx.AutomationUploader(uri, httpClient);
 }
 return _batchUploader;
}
</pre>
</div>
</div>
<div class="field"><h4 id="uploadTimeout">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Duration.html">Duration</a>         <strong>uploadTimeout</strong> <a class="anchor-link"
            href="#uploadTimeout"
            title="Permalink to OperationRequest.uploadTimeout">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Duration execTimeout, uploadTimeout
</pre>
</div>
</div>
<div class="field inherited"><h4 id="uri">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Uri.html">Uri</a>         <strong>uri</strong> <a class="anchor-link"
            href="#uri"
            title="Permalink to OperationRequest.uri">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
Uri uri
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="call">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_async/Future.html">Future</a> <strong>call</strong>({input: null, <a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&lt;<a href="http://api.dartlang.org/dart_core/String.html">String</a>, <a href="http://api.dartlang.org/dart_core/Object.html">Object</a>&gt; params: null, <a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&lt;<a href="http://api.dartlang.org/dart_core/String.html">String</a>, <a href="http://api.dartlang.org/dart_core/String.html">String</a>&gt; context: null, <a href="http://api.dartlang.org/dart_core/String.html">String</a> repository, <a href="http://api.dartlang.org/dart_core/String.html">String</a> documentSchemas: "dublincore", <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> voidOp: false}) <a class="anchor-link" href="#call"
              title="Permalink to OperationRequest.call">#</a></h4>
<div class="doc">
<p>Call the operation.
Returns a <a class="crossref" href="../dart_async/Future.html">Future</a>
Throws <code>ClientException</code></p>
<pre class="source">
Future call({
       dynamic input: null,
       Map&lt;String, Object&gt; params: null,
       Map&lt;String, String&gt; context: null,
       String repository,
       String documentSchemas: "dublincore",
       bool voidOp: false}) =&gt; op.then((nx.Operation op) {

   if (op == null) {
     throw new ArgumentError("No such operation: $id");
   }

   var data = {};

   // Setup the parameters
   if (params != null) {
     data["params"] = {};
     params.forEach((key, value) {
       var param = op[key];
       if (param == null) {
         throw new ArgumentError("No such parameter '$key' for operation ${op.id}.");
       }
       if (value != null) {
         data["params"][key] = value;
       }
     });
   }

   var targetUri = _opUri;

   // Check for batch upload
   if (_hasBatchUpload) {
     if (data["params"] == null) {
       data["params"] = {};
     }
     data["params"]["operationId"] = id;
     data["params"]["batchId"] = batchId;

     // Override the target url
     targetUri = Uri.parse("${uri}/batch/execute");
   }

   var isMultipart = (input is http.Blob);

   // Setup the input
   if (input != null &amp;&amp; !isMultipart) {
     data["input"] = input;
   }

   // Setup the context
   if (context != null) {
     data["context"] = context;
   }

   var request = httpClient.post(targetUri, multipart: isMultipart);

   // Setup the headers
   setRequestHeaders(request, repository: repository, documentSchemas: documentSchemas);

   request.headers.set(nx.HEADER_NX_VOIDOP, voidOp.toString());

   var json = JSON.encode(data);
   LOG.finest("Request: $json");

   // The data to send
   var requestData;

   // check for multipart request
   if (isMultipart) {
     var params = new http.Blob(content: json, mimetype: nx.CTYPE_REQUEST_NOCHARSET, filename: "request");
     var formData = new http.MultipartFormData();
     formData.append("request", params);
     formData.append(input.filename, input);
     requestData = formData;
   } else {
     // Set the content type
     request.headers.set(http.HEADER_CONTENT_TYPE, nx.CTYPE_REQUEST_NOCHARSET);
     requestData = json;
   }

   return request
       .send(requestData)
       .catchError((e) {
         throw new nx.ClientException(e.message);
       })
       .then(handleResponse);


});
</pre>
</div>
</div>
<div class="method inherited"><h4 id="handleResponse">
<button class="show-code">Code</button>
dynamic <strong>handleResponse</strong>(response) <a class="anchor-link" href="#handleResponse"
              title="Permalink to OperationRequest.handleResponse">#</a></h4>
<div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
handleResponse(response) {
 var body = response.body;

 LOG.finest("Response: $body");

 var json = JSON.decode(body);

 switch (json["entity-type"]) {
   case "document":
     return new Document.fromJSON(json);
     break;
   case "documents":
     var docs = json["entries"].map((doc) =&gt; new Document.fromJSON(doc));

     if (!json.containsKey("isPaginable") || !json["isPaginable"]) {
       return docs;
     }

     return new PaginableDocuments(docs)
         ..totalSize = json["totalSize"]
         ..pageIndex = json["pageIndex"]
         ..pageSize = json["pageSize"]
         ..pageCount = json["pageCount"];

     break;
   case "exception":
     throw new Exception(json["message"]);
     break;
 }
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="setRequestHeaders">
<button class="show-code">Code</button>
dynamic <strong>setRequestHeaders</strong>(<a href="../http_client/Request.html">Request</a> request, {<a href="http://api.dartlang.org/dart_core/String.html">String</a> repository, <a href="http://api.dartlang.org/dart_core/String.html">String</a> documentSchemas: "dublincore"}) <a class="anchor-link" href="#setRequestHeaders"
              title="Permalink to OperationRequest.setRequestHeaders">#</a></h4>
<div class="inherited-from">inherited from <a href="../nuxeo_client/Request.html">Request</a> </div><div class="doc">
<pre class="source">
setRequestHeaders(http.Request request, {
   String repository,
   String documentSchemas: "dublincore"}) {

 // Set the timeout
 var txTimeout = 5 + ((execTimeout != null) ? execTimeout.inSeconds : 0);
 request.headers.set(HEADER_NX_TX_TIMEOUT, txTimeout.toString());

 // Set the schemas
 if (documentSchemas.isNotEmpty) {
   request.headers.set(HEADER_NX_SCHEMAS, documentSchemas);
 }

 // Set the repository
 if (repository == null) {
   repository = repo;
 }
 if (repository != null) {
   request.headers.set(HEADER_NX_REPOSITORY, repository);
 }
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
